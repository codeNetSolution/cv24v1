<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Envoyer un CV</title>
</head>
<body>
<h1>Envoyer un CV</h1>
<form id="cvForm">
    <!-- Identité -->
    <fieldset>
        <legend>Identité</legend>
        <label for="genre">Genre:</label>
        <select id="genre">
            <option value="Mme">Mme</option>
            <option value="M.">M.</option>
            <option value="Mrs">Mrs</option>
            <option value="Miss">Miss</option>
            <option value="Mr">Mr</option>
        </select><br><br>
        <label for="prenom">Prénom:</label>
        <input type="text" id="prenom"><br><br>
        <label for="nom">Nom:</label>
        <input type="text" id="nom"><br><br>
        <label for="telephone">Téléphone:</label>
        <input type="text" id="telephone"><br><br>
        <label for="email">Email:</label>
        <input type="email" id="email"><br><br>
    </fieldset>

    <!-- Objectif -->
    <fieldset>
        <legend>Objectif Statut</legend>
        <label for="objectifIntitule">Intitulé:</label>
        <input type="text" id="objectifIntitule"><br><br>
        <label for="typeContrat">Type de Contrat:</label>
        <input type="text" id="typeContrat"><br><br>
    </fieldset>

    <!-- Expériences Professionnelles -->
    <fieldset>
        <legend>Expériences Professionnelles</legend>
        <label for="profDetail">Détail:</label>
        <textarea id="profDetail"></textarea><br><br>
        <label for="profStart">Date de début:</label>
        <input type="date" id="profStart"><br><br>
        <label for="profEnd">Date de fin:</label>
        <input type="date" id="profEnd"><br><br>
        <label for="profTitle">Titre:</label>
        <input type="text" id="profTitle"><br><br>
    </fieldset>

    <!-- Compétences -->
    <fieldset>
        <legend>Compétences</legend>
        <label for="competenceTitle">Titre:</label>
        <input type="text" id="competenceTitle"><br><br>
        <label for="competenceStart">Date de début:</label>
        <input type="date" id="competenceStart"><br><br>
        <label for="competenceEnd">Date de fin:</label>
        <input type="date" id="competenceEnd"><br><br>
    </fieldset>

    <!-- Diplômes -->
    <fieldset id="diplomesFieldset">
        <legend>Diplômes</legend>
        <div class="diplome">
            <label for="diplomeIntitule">Intitulé:</label>
            <input type="text" class="diplomeIntitule"><br><br>
            <label for="diplomeNiveau">Niveau:</label>
            <input type="number" class="diplomeNiveau"><br><br>
            <label for="diplomeDate">Date:</label>
            <input type="date" class="diplomeDate"><br><br>
            <label for="diplomeInstitut">Institut:</label>
            <input type="text" class="diplomeInstitut"><br><br>
        </div>
    </fieldset>
    <button type="button" onclick="addDiplome()">Ajouter un Diplôme</button><br><br>

    <!-- Certifications -->
    <fieldset>
        <legend>Certifications</legend>
        <label for="certifTitre">Titre de la Certification:</label>
        <input type="text" id="certifTitre"><br><br>
        <label for="certifDateDeb">Date de début:</label>
        <input type="date" id="certifDateDeb"><br><br>
        <label for="certifDateFin">Date de fin (facultatif):</label>
        <input type="date" id="certifDateFin"><br><br>
    </fieldset>


    <!-- Langues -->
    <fieldset>
        <legend>Langues</legend>
        <label for="langue">Langue:</label>
        <input type="text" id="langue"><br><br>
        <label for="certification">Certification:</label>
        <input type="text" id="certification"><br><br>
        <label for="toeicScore">Niveau TOEIC:</label>
        <input type="number" id="toeicScore"><br><br>
        <label for="clesLevel">Niveau CLES:</label>
        <input type="text" id="clesLevel"><br><br>
    </fieldset>

    <fieldset>
        <legend>Autres informations</legend>
        <label for="autreTitre">Titre:</label>
        <input type="text" id="autreTitre"><br><br>
        <label for="autreComment">Commentaire:</label>
        <textarea id="autreComment"></textarea><br><br>
    </fieldset>

    <label for="autreDivers">Divers:</label>
    <input type="text" id="autreDivers"><br><br>

    <button type="button" onclick="submitCV()">Envoyer CV</button>
</form>

<script>
    function addDiplome() {
        const diplomeFieldset = document.getElementById('diplomesFieldset');
        const newDiplomeDiv = document.createElement('div');
        newDiplomeDiv.className = 'diplome';
        newDiplomeDiv.innerHTML = `
            <label for="diplomeIntitule">Intitulé:</label>
            <input type="text" class="diplomeIntitule"><br><br>
            <label for="diplomeNiveau">Niveau:</label>
            <input type="number" class="diplomeNiveau"><br><br>
            <label for="diplomeDate">Date:</label>
            <input type="date" class="diplomeDate"><br><br>
            <label for="diplomeInstitut">Institut:</label>
            <input type="text" class="diplomeInstitut"><br><br>
        `;
        diplomeFieldset.appendChild(newDiplomeDiv);
    }

    function submitCV() {
        const genre = document.getElementById('genre').value;
        const prenom = document.getElementById('prenom').value;
        const nom = document.getElementById('nom').value;
        const telephone = document.getElementById('telephone').value;
        const email = document.getElementById('email').value;

        const objectifIntitule = document.getElementById('objectifIntitule').value;
        const typeContrat = document.getElementById('typeContrat').value;

        const profDetail = document.getElementById('profDetail').value;
        const profStart = document.getElementById('profStart').value;
        const profEnd = document.getElementById('profEnd').value;
        const profTitle = document.getElementById('profTitle').value;

        const competenceTitle = document.getElementById('competenceTitle').value;
        const competenceStart = document.getElementById('competenceStart').value;
        const competenceEnd = document.getElementById('competenceEnd').value;

        const diplomeElements = document.querySelectorAll('.diplome');
        let diplomesXML = '';
        diplomeElements.forEach(diplome => {
            const diplomeIntitule = diplome.querySelector('.diplomeIntitule').value;
            const diplomeNiveau = diplome.querySelector('.diplomeNiveau').value;
            const diplomeDate = diplome.querySelector('.diplomeDate').value;
            const diplomeInstitut = diplome.querySelector('.diplomeInstitut').value;
            diplomesXML += `
                <diplome-niveau>
                    <intitule>${diplomeIntitule}</intitule>
                    <niveau>${diplomeNiveau}</niveau>
                    <date>${diplomeDate}</date>
                    <institut>${diplomeInstitut}</institut>
                </diplome-niveau>
            `;
        });

        const certifTitre = document.getElementById('certifTitre').value;
        const certifDateDeb = document.getElementById('certifDateDeb').value;
        const certifDateFin = document.getElementById('certifDateFin').value;

        const langue = document.getElementById('langue').value;
        const certification = document.getElementById('certification').value;
        const toeicScore = document.getElementById('toeicScore').value;
        const clesLevel = document.getElementById('clesLevel').value;

        const autreTitre = document.getElementById('autreTitre').value;
        const autreComment = document.getElementById('autreComment').value;

        const autreDivers = document.getElementById('autreDivers').value;

        // Construction du XML
        const xmlData = `
        <TestCV xmlns="http://univ.fr/cv24">
            <identite>
                <genre>${genre}</genre>
                <firstame>${prenom}</firstame>
                <lastname>${nom}</lastname>
                <tel>${telephone}</tel>
                <mail>${email}</mail>
            </identite>
            <objectif-statut>
                <initule>${objectifIntitule}</initule>
                <typeContrat>${typeContrat}</typeContrat>
            </objectif-statut>
            <profs>
                <prof>
                    <detail>${profDetail}</detail>
                    <datedeb>${profStart}</datedeb>
                    <datefin>${profEnd}</datefin>
                    <titre>${profTitle}</titre>
                </prof>
            </profs>
            <competencesList>
                <competences>
                    <titre>${competenceTitle}</titre>
                    <datedeb>${competenceStart}</datedeb>
                    <datefin>${competenceEnd}</datefin>
                </competences>
            </competencesList>
            <diplomes>
                ${diplomesXML}
            </diplomes>
            <certifs>
                <certif>
                    <datedeb>${certifDateDeb}</datedeb>
                    <titre>${certifTitre}</titre>
                </certif>
            </certifs>
            <langues>
                <langue>
                    <lang>${langue}</lang>
                    <cert>${certification}</cert>
                    <nivs>${toeicScore}</nivs>
                    <nivi>${clesLevel}</nivi>
                </langue>
            </langues>

            <autre>
                <divers>
                    <divers>${autreDivers}</divers>
                    <comment>${autreComment}</comment>
                </divers>
            </autre>
        </TestCV>
    `;

        fetch('http://localhost:8080/cv24/insert', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/xml',
            },
            body: xmlData
        })
            .then(response => response.text())
            .then(data => {
                alert('Réponse du serveur: ' + data);
            })
            .catch((error) => {
                console.error('Erreur:', error);
            });
    }
</script>
</body>
</html>
